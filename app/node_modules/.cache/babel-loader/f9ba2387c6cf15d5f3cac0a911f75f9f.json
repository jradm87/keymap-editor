{"ast":null,"code":"import _asyncToGenerator from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _slicedToArray from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"layout\",\"keymap\"];import _regeneratorRuntime from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/regenerator/index.js\";import compact from'lodash/compact';import{useEffect,useMemo,useState}from'react';import*as config from'../config';import{loadLayout}from'../layout.js';import{loadKeymap}from'../keymap.js';import Selector from\"../Common/Selector\";import GithubPicker from'./Github/Picker';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var sourceChoices=compact([config.enableLocal?{id:'local',name:'Local'}:null,config.enableGitHub?{id:'github',name:'GitHub'}:null]);var selectedSource=localStorage.getItem('selectedSource');var onlySource=sourceChoices.length===1?sourceChoices[0].id:null;var defaultSource=onlySource||(sourceChoices.find(function(source){return source.id===selectedSource;})?selectedSource:null);function KeyboardPicker(props){var onSelect=props.onSelect;var _useState=useState(defaultSource),_useState2=_slicedToArray(_useState,2),source=_useState2[0],setSource=_useState2[1];var handleKeyboardSelected=useMemo(function(){return function(event){var layout=event.layout,keymap=event.keymap,rest=_objectWithoutProperties(event,_excluded);var layerNames=keymap.layer_names||keymap.layers.map(function(_,i){return\"Layer \".concat(i);});Object.assign(keymap,{layer_names:layerNames});onSelect(_objectSpread({source:source,layout:layout,keymap:keymap},rest));};},[onSelect,source]);var fetchLocalKeyboard=useMemo(function(){return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,layout,keymap;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([loadLayout(),loadKeymap()]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);layout=_yield$Promise$all2[0];keymap=_yield$Promise$all2[1];handleKeyboardSelected({source:source,layout:layout,keymap:keymap});case 7:case\"end\":return _context.stop();}}},_callee);}));},[source,handleKeyboardSelected]);useEffect(function(){localStorage.setItem('selectedSource',source);if(source==='local'){fetchLocalKeyboard();}},[source,fetchLocalKeyboard]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Selector,{id:\"source\",label:\"Source\",value:source,choices:sourceChoices,onUpdate:function onUpdate(value){setSource(value);onSelect(value);}}),source==='github'&&/*#__PURE__*/_jsx(GithubPicker,{onSelect:handleKeyboardSelected})]});}export default KeyboardPicker;","map":{"version":3,"names":["compact","useEffect","useMemo","useState","config","loadLayout","loadKeymap","Selector","GithubPicker","sourceChoices","enableLocal","id","name","enableGitHub","selectedSource","localStorage","getItem","onlySource","length","defaultSource","find","source","KeyboardPicker","props","onSelect","setSource","handleKeyboardSelected","event","layout","keymap","rest","layerNames","layer_names","layers","map","_","i","Object","assign","fetchLocalKeyboard","Promise","all","setItem","value"],"sources":["/home/runner/work/keymap-editor/keymap-editor/app/src/Pickers/KeyboardPicker.js"],"sourcesContent":["import compact from 'lodash/compact'\nimport { useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\n\nimport * as config from '../config'\nimport { loadLayout } from '../layout.js'\nimport { loadKeymap } from '../keymap.js'\nimport Selector from \"../Common/Selector\"\nimport GithubPicker from './Github/Picker'\n\nconst sourceChoices = compact([\n  config.enableLocal ? { id: 'local', name: 'Local' } : null,\n  config.enableGitHub ? { id: 'github', name: 'GitHub' } : null\n])\n\nconst selectedSource = localStorage.getItem('selectedSource')\nconst onlySource = sourceChoices.length === 1 ? sourceChoices[0].id : null\nconst defaultSource = onlySource || (\n  sourceChoices.find(source => source.id === selectedSource)\n    ? selectedSource\n    : null\n)\n\nfunction KeyboardPicker(props) {\n  const { onSelect } = props\n  const [source, setSource] = useState(defaultSource)\n\n  const handleKeyboardSelected = useMemo(() => function (event) {\n    const { layout, keymap, ...rest } = event\n\n    const layerNames = keymap.layer_names || keymap.layers.map((_, i) => `Layer ${i}`)\n    Object.assign(keymap, {\n      layer_names: layerNames\n    })\n\n    onSelect({ source, layout, keymap, ...rest })\n  }, [onSelect, source])\n\n  const fetchLocalKeyboard = useMemo(() => async function() {\n    const [layout, keymap] = await Promise.all([\n      loadLayout(),\n      loadKeymap()\n    ])\n\n    handleKeyboardSelected({ source, layout, keymap })\n  }, [source, handleKeyboardSelected])\n\n  useEffect(() => {\n    localStorage.setItem('selectedSource', source)\n    if (source === 'local') {\n      fetchLocalKeyboard()\n    }\n  }, [source, fetchLocalKeyboard])\n\n  return (\n    <div>\n      <Selector\n        id=\"source\"\n        label=\"Source\"\n        value={source}\n        choices={sourceChoices}\n        onUpdate={value => {\n          setSource(value)\n          onSelect(value)\n        }}\n      />\n\n      {source === 'github' && (\n        <GithubPicker onSelect={handleKeyboardSelected} />\n      )}\n    </div>\n  )\n}\n\nKeyboardPicker.propTypes = {\n  onSelect: PropTypes.func.isRequired\n}\n\nexport default KeyboardPicker\n"],"mappings":"2tBAAA,MAAOA,CAAAA,OAAP,KAAoB,gBAApB,CACA,OAASC,SAAT,CAAoBC,OAApB,CAA6BC,QAA7B,KAA6C,OAA7C,CAGA,MAAO,GAAKC,CAAAA,MAAZ,KAAwB,WAAxB,CACA,OAASC,UAAT,KAA2B,cAA3B,CACA,OAASC,UAAT,KAA2B,cAA3B,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,MAAOC,CAAAA,YAAP,KAAyB,iBAAzB,C,wFAEA,GAAMC,CAAAA,aAAa,CAAGT,OAAO,CAAC,CAC5BI,MAAM,CAACM,WAAP,CAAqB,CAAEC,EAAE,CAAE,OAAN,CAAeC,IAAI,CAAE,OAArB,CAArB,CAAsD,IAD1B,CAE5BR,MAAM,CAACS,YAAP,CAAsB,CAAEF,EAAE,CAAE,QAAN,CAAgBC,IAAI,CAAE,QAAtB,CAAtB,CAAyD,IAF7B,CAAD,CAA7B,CAKA,GAAME,CAAAA,cAAc,CAAGC,YAAY,CAACC,OAAb,CAAqB,gBAArB,CAAvB,CACA,GAAMC,CAAAA,UAAU,CAAGR,aAAa,CAACS,MAAd,GAAyB,CAAzB,CAA6BT,aAAa,CAAC,CAAD,CAAb,CAAiBE,EAA9C,CAAmD,IAAtE,CACA,GAAMQ,CAAAA,aAAa,CAAGF,UAAU,GAC9BR,aAAa,CAACW,IAAd,CAAmB,SAAAC,MAAM,QAAIA,CAAAA,MAAM,CAACV,EAAP,GAAcG,cAAlB,EAAzB,EACIA,cADJ,CAEI,IAH0B,CAAhC,CAMA,QAASQ,CAAAA,cAAT,CAAwBC,KAAxB,CAA+B,CAC7B,GAAQC,CAAAA,QAAR,CAAqBD,KAArB,CAAQC,QAAR,CACA,cAA4BrB,QAAQ,CAACgB,aAAD,CAApC,wCAAOE,MAAP,eAAeI,SAAf,eAEA,GAAMC,CAAAA,sBAAsB,CAAGxB,OAAO,CAAC,iBAAM,UAAUyB,KAAV,CAAiB,CAC5D,GAAQC,CAAAA,MAAR,CAAoCD,KAApC,CAAQC,MAAR,CAAgBC,MAAhB,CAAoCF,KAApC,CAAgBE,MAAhB,CAA2BC,IAA3B,0BAAoCH,KAApC,YAEA,GAAMI,CAAAA,UAAU,CAAGF,MAAM,CAACG,WAAP,EAAsBH,MAAM,CAACI,MAAP,CAAcC,GAAd,CAAkB,SAACC,CAAD,CAAIC,CAAJ,wBAAmBA,CAAnB,GAAlB,CAAzC,CACAC,MAAM,CAACC,MAAP,CAAcT,MAAd,CAAsB,CACpBG,WAAW,CAAED,UADO,CAAtB,EAIAP,QAAQ,gBAAGH,MAAM,CAANA,MAAH,CAAWO,MAAM,CAANA,MAAX,CAAmBC,MAAM,CAANA,MAAnB,EAA8BC,IAA9B,EAAR,CACD,CATsC,EAAD,CASnC,CAACN,QAAD,CAAWH,MAAX,CATmC,CAAtC,CAWA,GAAMkB,CAAAA,kBAAkB,CAAGrC,OAAO,CAAC,sFAAM,kNACRsC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACzCpC,UAAU,EAD+B,CAEzCC,UAAU,EAF+B,CAAZ,CADQ,kGAChCsB,MADgC,wBACxBC,MADwB,wBAMvCH,sBAAsB,CAAC,CAAEL,MAAM,CAANA,MAAF,CAAUO,MAAM,CAANA,MAAV,CAAkBC,MAAM,CAANA,MAAlB,CAAD,CAAtB,CANuC,sDAAN,IAAD,CAO/B,CAACR,MAAD,CAASK,sBAAT,CAP+B,CAAlC,CASAzB,SAAS,CAAC,UAAM,CACdc,YAAY,CAAC2B,OAAb,CAAqB,gBAArB,CAAuCrB,MAAvC,EACA,GAAIA,MAAM,GAAK,OAAf,CAAwB,CACtBkB,kBAAkB,GACnB,CACF,CALQ,CAKN,CAAClB,MAAD,CAASkB,kBAAT,CALM,CAAT,CAOA,mBACE,oCACE,KAAC,QAAD,EACE,EAAE,CAAC,QADL,CAEE,KAAK,CAAC,QAFR,CAGE,KAAK,CAAElB,MAHT,CAIE,OAAO,CAAEZ,aAJX,CAKE,QAAQ,CAAE,kBAAAkC,KAAK,CAAI,CACjBlB,SAAS,CAACkB,KAAD,CAAT,CACAnB,QAAQ,CAACmB,KAAD,CAAR,CACD,CARH,EADF,CAYGtB,MAAM,GAAK,QAAX,eACC,KAAC,YAAD,EAAc,QAAQ,CAAEK,sBAAxB,EAbJ,GADF,CAkBD,CAMD,cAAeJ,CAAAA,cAAf"},"metadata":{},"sourceType":"module"}