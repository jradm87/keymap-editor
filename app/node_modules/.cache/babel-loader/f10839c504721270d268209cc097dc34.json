{"ast":null,"code":"import _slicedToArray from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import cloneDeep from'lodash/cloneDeep';import get from'lodash/get';import pick from'lodash/pick';import{useContext,useState}from'react';import{SearchContext}from'../../providers';import{getBehaviourParams}from'../../keymap';import{getKeyStyles}from'../../key-units';import KeyParamlist from'./KeyParamlist';import*as keyPropTypes from'./keyPropTypes';import{createPromptMessage,hydrateTree,isSimple,isComplex,makeIndex}from'./util';import styles from'./styles.module.css';import Modal from'../../Common/Modal';import ValuePicker from'../../ValuePicker';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Key(props){var _useContext=useContext(SearchContext),getSearchTargets=_useContext.getSearchTargets,sources=_useContext.sources;var position=props.position,rotation=props.rotation,size=props.size;var label=props.label,value=props.value,params=props.params,onUpdate=props.onUpdate;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),editing=_useState2[0],setEditing=_useState2[1];var bind=value;var behaviour=get(sources.behaviours,bind);var behaviourParams=getBehaviourParams(params,behaviour);var normalized=hydrateTree(value,params,sources);var index=makeIndex(normalized);var positioningStyle=getKeyStyles(position,size,rotation);function onMouseOver(event){var old=document.querySelector(\".\".concat(styles.highlight));old&&old.classList.remove(styles.highlight);event.target.classList.add(styles.highlight);}function onMouseLeave(event){event.target.classList.remove(styles.highlight);}function handleSelectCode(event){var editing=pick(event,['target','codeIndex','code','param']);editing.targets=getSearchTargets(editing.param,value);setEditing(editing);}function handleSelectBehaviour(event){event.stopPropagation();setEditing({target:event.target,targets:getSearchTargets('behaviour',value),codeIndex:0,code:value,param:'behaviour'});}function handleSelectValue(source){var codeIndex=editing.codeIndex;var updated=cloneDeep(normalized);var index=makeIndex(updated);var targetCode=index[codeIndex];targetCode.value=source.code;targetCode.params=[];index.forEach(function(node){delete node.source;});setEditing(null);onUpdate(pick(updated,['value','params']));}return/*#__PURE__*/_jsxs(\"div\",{className:styles.key,\"data-label\":label,\"data-u\":size.u,\"data-h\":size.h,\"data-simple\":isSimple(normalized),\"data-long\":isComplex(normalized,behaviourParams),style:positioningStyle,onMouseOver:onMouseOver,onMouseLeave:onMouseLeave,children:[behaviour?/*#__PURE__*/_jsx(\"span\",{className:styles['behaviour-binding'],onClick:handleSelectBehaviour,children:behaviour.code}):null,/*#__PURE__*/_jsx(KeyParamlist,{root:true,index:index,params:behaviourParams,values:normalized.params,onSelect:handleSelectCode}),editing&&/*#__PURE__*/_jsx(Modal,{children:/*#__PURE__*/_jsx(ValuePicker,{target:editing.target,value:editing.code,param:editing.param,choices:editing.targets,prompt:createPromptMessage(editing.param),searchKey:\"code\",onSelect:handleSelectValue,onCancel:function onCancel(){return setEditing(null);}})})]});}export default Key;","map":{"version":3,"names":["cloneDeep","get","pick","useContext","useState","SearchContext","getBehaviourParams","getKeyStyles","KeyParamlist","keyPropTypes","createPromptMessage","hydrateTree","isSimple","isComplex","makeIndex","styles","Modal","ValuePicker","Key","props","getSearchTargets","sources","position","rotation","size","label","value","params","onUpdate","editing","setEditing","bind","behaviour","behaviours","behaviourParams","normalized","index","positioningStyle","onMouseOver","event","old","document","querySelector","highlight","classList","remove","target","add","onMouseLeave","handleSelectCode","targets","param","handleSelectBehaviour","stopPropagation","codeIndex","code","handleSelectValue","source","updated","targetCode","forEach","node","key","u","h"],"sources":["/home/runner/work/keymap-editor/keymap-editor/app/src/Keyboard/Keys/Key.js"],"sourcesContent":["import cloneDeep from 'lodash/cloneDeep'\nimport get from 'lodash/get'\nimport pick from 'lodash/pick'\nimport PropTypes from 'prop-types'\nimport { useContext, useState } from 'react'\n\nimport { SearchContext } from '../../providers'\nimport { getBehaviourParams } from '../../keymap'\nimport { getKeyStyles } from '../../key-units'\n\nimport KeyParamlist from './KeyParamlist'\nimport * as keyPropTypes from './keyPropTypes'\nimport {\n  createPromptMessage,\n  hydrateTree,\n  isSimple,\n  isComplex,\n  makeIndex\n} from './util'\nimport styles from './styles.module.css'\n\nimport Modal from '../../Common/Modal'\nimport ValuePicker from '../../ValuePicker'\n\nfunction Key(props) {\n  const { getSearchTargets, sources } = useContext(SearchContext)\n  const { position, rotation, size } = props\n  const { label, value, params, onUpdate } = props\n  const [editing, setEditing] = useState(null)\n\n  const bind = value\n  const behaviour = get(sources.behaviours, bind)\n  const behaviourParams = getBehaviourParams(params, behaviour)\n\n  const normalized = hydrateTree(value, params, sources)\n\n  const index = makeIndex(normalized)\n  const positioningStyle = getKeyStyles(position, size, rotation)\n\n  function onMouseOver(event) {\n    const old = document.querySelector(`.${styles.highlight}`)\n    old && old.classList.remove(styles.highlight)\n    event.target.classList.add(styles.highlight)\n  }\n  function onMouseLeave(event) {\n    event.target.classList.remove(styles.highlight)\n  }\n\n  function handleSelectCode(event) {\n    const editing = pick(event, ['target', 'codeIndex', 'code', 'param'])\n    editing.targets = getSearchTargets(editing.param, value)\n    setEditing(editing)\n  }\n  function handleSelectBehaviour(event) {\n    event.stopPropagation()\n    setEditing({\n      target: event.target,\n      targets: getSearchTargets('behaviour', value),\n      codeIndex: 0,\n      code: value,\n      param: 'behaviour'\n    })\n  }\n  function handleSelectValue(source) {\n    const { codeIndex } = editing\n    const updated = cloneDeep(normalized)\n    const index = makeIndex(updated)\n    const targetCode = index[codeIndex]\n\n    targetCode.value = source.code\n    targetCode.params = []\n    index.forEach(node => {\n      delete node.source\n    })\n\n    setEditing(null)\n    onUpdate(pick(updated, ['value', 'params']))\n  }\n\n  return (\n    <div\n      className={styles.key}\n      data-label={label}\n      data-u={size.u}\n      data-h={size.h}\n      data-simple={isSimple(normalized)}\n      data-long={isComplex(normalized, behaviourParams)}\n      style={positioningStyle}\n      onMouseOver={onMouseOver}\n      onMouseLeave={onMouseLeave}\n    >\n    {behaviour ? (\n      <span\n        className={styles['behaviour-binding']}\n        onClick={handleSelectBehaviour}\n      >\n        {behaviour.code}\n      </span>\n    ) : null}\n    <KeyParamlist\n      root={true}\n      index={index}\n      params={behaviourParams}\n      values={normalized.params}\n      onSelect={handleSelectCode}\n    />\n    {editing && (\n      <Modal>\n        <ValuePicker\n          target={editing.target}\n          value={editing.code}\n          param={editing.param}\n          choices={editing.targets}\n          prompt={createPromptMessage(editing.param)}\n          searchKey=\"code\"\n          onSelect={handleSelectValue}\n          onCancel={() => setEditing(null)}\n        />\n      </Modal>\n    )}\n  </div>\n  )\n}\n\nKey.propTypes = {\n  position: PropTypes.shape({\n    x: PropTypes.number.isRequired,\n    y: PropTypes.number.isRequired\n  }),\n  rotation: PropTypes.shape({\n    a: PropTypes.number,\n    rx: PropTypes.number,\n    ry: PropTypes.number\n  }),\n  size: PropTypes.shape({\n    u: PropTypes.number.isRequired,\n    h: PropTypes.number.isRequired\n  }),\n  label: PropTypes.string,\n  value: keyPropTypes.value.isRequired,\n  params: PropTypes.arrayOf(keyPropTypes.node),\n  onUpdate: PropTypes.func.isRequired\n}\n\nexport default Key\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}