{"ast":null,"code":"import _objectWithoutProperties from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _asyncToGenerator from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"source\",\"layout\",\"keymap\"];import _regeneratorRuntime from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/regenerator/index.js\";import'@fortawesome/fontawesome-free/css/all.css';import keyBy from'lodash/keyBy';import{useMemo,useState}from'react';import*as config from'./config';import'./App.css';import{DefinitionsContext}from'./providers';import{loadKeycodes}from'./keycodes';import{loadBehaviours}from'./api';import KeyboardPicker from'./Pickers/KeyboardPicker';import Spinner from'./Common/Spinner';import Keyboard from'./Keyboard/Keyboard';import GitHubLink from'./GitHubLink';import Loader from'./Common/Loader';import github from'./Pickers/Github/api';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),definitions=_useState2[0],setDefinitions=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),source=_useState4[0],setSource=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),sourceOther=_useState6[0],setSourceOther=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),layout=_useState8[0],setLayout=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),keymap=_useState10[0],setKeymap=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),editingKeymap=_useState12[0],setEditingKeymap=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),saving=_useState14[0],setSaving=_useState14[1];function handleCompile(){fetch(\"\".concat(config.apiBaseUrl,\"/keymap\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(editingKeymap||keymap)});}var handleCommitChanges=useMemo(function(){return function(){var _sourceOther$github=sourceOther.github,repository=_sourceOther$github.repository,branch=_sourceOther$github.branch;_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setSaving(true);_context.next=3;return github.commitChanges(repository,branch,layout,editingKeymap);case 3:setSaving(false);setKeymap(editingKeymap);setEditingKeymap(null);case 6:case\"end\":return _context.stop();}}},_callee);}))();};},[layout,editingKeymap,sourceOther,setSaving,setKeymap,setEditingKeymap]);var handleKeyboardSelected=useMemo(function(){return function(event){var source=event.source,layout=event.layout,keymap=event.keymap,other=_objectWithoutProperties(event,_excluded);setSource(source);setSourceOther(other);setLayout(layout);setKeymap(keymap);setEditingKeymap(null);};},[setSource,setSourceOther,setLayout,setKeymap,setEditingKeymap]);var initialize=useMemo(function(){return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$Promise$all,_yield$Promise$all2,keycodes,behaviours;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Promise.all([loadKeycodes(),loadBehaviours()]);case 2:_yield$Promise$all=_context2.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);keycodes=_yield$Promise$all2[0];behaviours=_yield$Promise$all2[1];keycodes.indexed=keyBy(keycodes,'code');behaviours.indexed=keyBy(behaviours,'code');setDefinitions({keycodes:keycodes,behaviours:behaviours});case 9:case\"end\":return _context2.stop();}}},_callee2);}));},[setDefinitions]);var handleUpdateKeymap=useMemo(function(){return function(keymap){setEditingKeymap(keymap);};},[setEditingKeymap]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Loader,{load:initialize,children:[/*#__PURE__*/_jsx(KeyboardPicker,{onSelect:handleKeyboardSelected}),/*#__PURE__*/_jsxs(\"div\",{id:\"actions\",children:[source==='local'&&/*#__PURE__*/_jsx(\"button\",{disabled:!editingKeymap,onClick:handleCompile,children:\"Save Local\"}),source==='github'&&/*#__PURE__*/_jsxs(\"button\",{title:\"Commit keymap changes to GitHub repository\",disabled:!editingKeymap,onClick:handleCommitChanges,children:[saving?'Saving':'Commit Changes',saving&&/*#__PURE__*/_jsx(Spinner,{})]})]}),/*#__PURE__*/_jsx(DefinitionsContext.Provider,{value:definitions,children:layout&&keymap&&/*#__PURE__*/_jsx(Keyboard,{layout:layout,keymap:editingKeymap||keymap,onUpdate:handleUpdateKeymap})})]}),/*#__PURE__*/_jsx(GitHubLink,{className:\"github-link\"})]});}export default App;","map":{"version":3,"names":["keyBy","useMemo","useState","config","DefinitionsContext","loadKeycodes","loadBehaviours","KeyboardPicker","Spinner","Keyboard","GitHubLink","Loader","github","App","definitions","setDefinitions","source","setSource","sourceOther","setSourceOther","layout","setLayout","keymap","setKeymap","editingKeymap","setEditingKeymap","saving","setSaving","handleCompile","fetch","apiBaseUrl","method","headers","body","JSON","stringify","handleCommitChanges","repository","branch","commitChanges","handleKeyboardSelected","event","other","initialize","Promise","all","keycodes","behaviours","indexed","handleUpdateKeymap"],"sources":["/home/runner/work/keymap-editor/keymap-editor/app/src/App.js"],"sourcesContent":["import '@fortawesome/fontawesome-free/css/all.css'\nimport keyBy from 'lodash/keyBy'\nimport { useMemo, useState } from 'react'\n\nimport * as config from './config'\nimport './App.css';\nimport { DefinitionsContext } from './providers'\nimport { loadKeycodes } from './keycodes'\nimport { loadBehaviours } from './api'\nimport KeyboardPicker from './Pickers/KeyboardPicker';\nimport Spinner from './Common/Spinner';\nimport Keyboard from './Keyboard/Keyboard'\nimport GitHubLink from './GitHubLink'\nimport Loader from './Common/Loader'\nimport github from './Pickers/Github/api'\n\nfunction App() {\n  const [definitions, setDefinitions] = useState(null)\n  const [source, setSource] = useState(null)\n  const [sourceOther, setSourceOther] = useState(null)\n  const [layout, setLayout] = useState(null)\n  const [keymap, setKeymap] = useState(null)\n  const [editingKeymap, setEditingKeymap] = useState(null)\n  const [saving, setSaving] = useState(false)\n\n  function handleCompile() {\n    fetch(`${config.apiBaseUrl}/keymap`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(editingKeymap || keymap)\n    })\n  }\n\n  const handleCommitChanges = useMemo(() => function() {\n    const { repository, branch } = sourceOther.github\n\n    ;(async function () {\n      setSaving(true)\n      await github.commitChanges(repository, branch, layout, editingKeymap)\n      setSaving(false)\n\n      setKeymap(editingKeymap)\n      setEditingKeymap(null)\n    })()\n  }, [\n    layout,\n    editingKeymap,\n    sourceOther,\n    setSaving,\n    setKeymap,\n    setEditingKeymap\n  ])\n\n  const handleKeyboardSelected = useMemo(() => function(event) {\n    const { source, layout, keymap, ...other } = event\n\n    setSource(source)\n    setSourceOther(other)\n    setLayout(layout)\n    setKeymap(keymap)\n    setEditingKeymap(null)\n  }, [\n    setSource,\n    setSourceOther,\n    setLayout,\n    setKeymap,\n    setEditingKeymap\n  ])\n\n  const initialize = useMemo(() => {\n    return async function () {\n      const [keycodes, behaviours] = await Promise.all([\n        loadKeycodes(),\n        loadBehaviours()\n      ])\n\n      keycodes.indexed = keyBy(keycodes, 'code')\n      behaviours.indexed = keyBy(behaviours, 'code')\n\n      setDefinitions({ keycodes, behaviours })\n    }\n  }, [setDefinitions])\n\n  const handleUpdateKeymap = useMemo(() => function(keymap) {\n    setEditingKeymap(keymap)\n  }, [setEditingKeymap])\n\n  return (\n    <>\n      <Loader load={initialize}>\n        <KeyboardPicker onSelect={handleKeyboardSelected} />\n        <div id=\"actions\">\n          {source === 'local' && (\n            <button disabled={!editingKeymap} onClick={handleCompile}>\n              Save Local\n            </button>\n          )}\n          {source === 'github' && (\n            <button\n              title=\"Commit keymap changes to GitHub repository\"\n              disabled={!editingKeymap}\n              onClick={handleCommitChanges}\n            >\n              {saving ? 'Saving' : 'Commit Changes'}\n              {saving && <Spinner />}\n            </button>\n          )}\n        </div>\n        <DefinitionsContext.Provider value={definitions}>\n          {layout && keymap && (\n            <Keyboard\n              layout={layout}\n              keymap={editingKeymap || keymap}\n              onUpdate={handleUpdateKeymap}\n            />\n          )}\n        </DefinitionsContext.Provider>\n      </Loader>\n      <GitHubLink className=\"github-link\" />\n    </>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}