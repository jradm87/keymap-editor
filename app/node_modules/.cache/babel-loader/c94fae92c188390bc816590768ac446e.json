{"ast":null,"code":"import _slicedToArray from\"/home/runner/work/keymap-editor/keymap-editor/app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useMemo,useRef,useState}from'react';import Icon from'../Common/Icon';import styles from'./styles.module.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function stop(fn){return function(event){event.stopPropagation();fn();};}function onKey(mapping){return function(event){if(mapping[event.key]){mapping[event.key]();}};}function LayerSelector(props){var ref=useRef(null);var activeLayer=props.activeLayer,layers=props.layers;var onSelect=props.onSelect,onNewLayer=props.onNewLayer,onRenameLayer=props.onRenameLayer,onDeleteLayer=props.onDeleteLayer;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),renaming=_useState2[0],setRenaming=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),editing=_useState4[0],setEditing=_useState4[1];var handleSelect=useMemo(function(){return function(layer){if(layer===activeLayer){setEditing(layers[activeLayer]);setRenaming(true);return;}setRenaming(false);onSelect(layer);};},[layers,activeLayer,setEditing,setRenaming,onSelect]);var handleAdd=useMemo(function(){return function(){onNewLayer();};},[onNewLayer]);var handleDelete=useMemo(function(){return function(layerIndex,layerName){var confirmation=\"Really delete layer: \".concat(layerName,\"?\");window.confirm(confirmation)&&onDeleteLayer(layerIndex);};},[onDeleteLayer]);var finishEditing=useCallback(function(){if(!renaming){return;}setEditing('');setRenaming(false);onRenameLayer(editing);},[editing,renaming,setEditing,setRenaming,onRenameLayer]);var cancelEditing=useCallback(function(){if(!renaming){return;}setEditing('');setRenaming(false);},[renaming,setEditing,setRenaming]);var handleClickOutside=useMemo(function(){return function(event){var clickedOutside=ref.current&&!ref.current.contains(event.target);if(!clickedOutside){return;}cancelEditing();};},[ref,cancelEditing]);useEffect(function(){document.addEventListener('click',handleClickOutside);return function(){return document.removeEventListener('click',handleClickOutside);};},[handleClickOutside]);var focusInput=useCallback(function(node){if(node){node.focus();node.select();}},[]);return/*#__PURE__*/_jsxs(\"div\",{className:styles['layer-selector'],\"data-renaming\":renaming,ref:ref,children:[/*#__PURE__*/_jsx(\"p\",{children:\"Layers:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[layers.map(function(name,i){return/*#__PURE__*/_jsxs(\"li\",{className:activeLayer===i?styles.active:'',\"data-layer\":i,onClick:stop(function(){return handleSelect(i);}),children:[/*#__PURE__*/_jsx(\"span\",{className:styles.index,children:i}),activeLayer===i&&renaming?/*#__PURE__*/_jsx(\"input\",{ref:focusInput,className:styles.name,onChange:function onChange(e){return setEditing(e.target.value);},onKeyDown:onKey({Enter:finishEditing,Escape:cancelEditing}),value:activeLayer===i&&renaming?editing:layers[i]}):/*#__PURE__*/_jsxs(\"span\",{className:styles.name,children:[name,/*#__PURE__*/_jsx(Icon,{name:\"times-circle\",className:styles.delete,onClick:stop(function(){return handleDelete(i,name);})})]})]},\"layer-\".concat(i));}),/*#__PURE__*/_jsxs(\"li\",{onClick:handleAdd,children:[/*#__PURE__*/_jsx(Icon,{className:styles.index,name:\"plus\"}),/*#__PURE__*/_jsx(\"span\",{className:styles.name,children:\"Add Layer\"})]})]})]});}export default LayerSelector;","map":{"version":3,"names":["useCallback","useEffect","useMemo","useRef","useState","Icon","styles","stop","fn","event","stopPropagation","onKey","mapping","key","LayerSelector","props","ref","activeLayer","layers","onSelect","onNewLayer","onRenameLayer","onDeleteLayer","renaming","setRenaming","editing","setEditing","handleSelect","layer","handleAdd","handleDelete","layerIndex","layerName","confirmation","window","confirm","finishEditing","cancelEditing","handleClickOutside","clickedOutside","current","contains","target","document","addEventListener","removeEventListener","focusInput","node","focus","select","map","name","i","active","index","e","value","Enter","Escape","delete"],"sources":["/home/runner/work/keymap-editor/keymap-editor/app/src/Keyboard/LayerSelector.js"],"sourcesContent":["import PropTypes from 'prop-types'\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react'\n\nimport Icon from '../Common/Icon'\nimport styles from './styles.module.css'\n\nfunction stop(fn) {\n  return function(event) {\n    event.stopPropagation()\n    fn()\n  }\n}\n\nfunction onKey(mapping) {\n  return function(event) {\n    if (mapping[event.key]) {\n      mapping[event.key]()\n    }\n  }\n}\n\nfunction LayerSelector(props) {\n  const ref = useRef(null)\n  const { activeLayer, layers } = props\n  const { onSelect, onNewLayer, onRenameLayer, onDeleteLayer } = props\n  const [renaming, setRenaming] = useState(false)\n  const [editing, setEditing] = useState('')\n\n  const handleSelect = useMemo(() => function(layer) {\n    if (layer === activeLayer) {\n      setEditing(layers[activeLayer])\n      setRenaming(true)\n      return\n    }\n\n    setRenaming(false)\n    onSelect(layer)\n  }, [layers, activeLayer, setEditing, setRenaming, onSelect])\n\n  const handleAdd = useMemo(() => function() {\n    onNewLayer()\n  }, [onNewLayer])\n\n  const handleDelete = useMemo(() => function(layerIndex, layerName) {\n    const confirmation = `Really delete layer: ${layerName}?`\n    window.confirm(confirmation) && onDeleteLayer(layerIndex)\n  }, [onDeleteLayer])\n\n  const finishEditing = useCallback(() => {\n    if (!renaming) {\n      return\n    }\n\n    setEditing('')\n    setRenaming(false)\n    onRenameLayer(editing)\n  }, [editing, renaming, setEditing, setRenaming, onRenameLayer])\n\n  const cancelEditing = useCallback(() => {\n    if (!renaming) {\n      return\n    }\n\n    setEditing('')\n    setRenaming(false)\n  }, [renaming, setEditing, setRenaming])\n\n  const handleClickOutside = useMemo(() => function(event) {\n    const clickedOutside = ref.current && !ref.current.contains(event.target)\n    if (!clickedOutside) {\n      return\n    }\n\n    cancelEditing()\n  }, [ref, cancelEditing])\n\n  useEffect(() => {\n    document.addEventListener('click', handleClickOutside)\n    return () => document.removeEventListener('click', handleClickOutside)\n  }, [handleClickOutside])\n\n  const focusInput = useCallback(node => {\n    if (node) {\n      node.focus()\n      node.select()\n    }\n  }, [])\n\n  return (\n    <div\n      className={styles['layer-selector']}\n      data-renaming={renaming}\n      ref={ref}\n    >\n      <p>Layers:</p>\n      <ul>\n        {layers.map((name, i) => (\n          <li\n            key={`layer-${i}`}\n            className={activeLayer === i ? styles.active : ''}\n            data-layer={i}\n            onClick={stop(() => handleSelect(i))}\n          >\n            <span className={styles.index}>{i}</span>\n            {(activeLayer === i && renaming) ? (\n              <input\n                ref={focusInput}\n                className={styles.name}\n                onChange={e => setEditing(e.target.value)}\n                onKeyDown={onKey({\n                  Enter: finishEditing,\n                  Escape: cancelEditing\n                })}\n                value={\n                  (activeLayer === i && renaming)\n                    ? editing\n                    : layers[i]\n                }\n              />\n            ) : (\n              <span className={styles.name}>\n                {name}\n                <Icon\n                  name=\"times-circle\"\n                  className={styles.delete}\n                  onClick={stop(() => handleDelete(i, name))}\n                />\n              </span>\n            )}\n          </li>\n        ))}\n        <li onClick={handleAdd}>\n          <Icon className={styles.index} name=\"plus\" />\n          <span className={styles.name}>Add Layer</span>\n        </li>\n      </ul>\n    </div>\n  )\n}\n\nLayerSelector.propTypes = {\n  layers: PropTypes.array.isRequired,\n  activeLayer: PropTypes.number.isRequired,\n  onSelect: PropTypes.func.isRequired,\n  onNewLayer: PropTypes.func.isRequired,\n  onRenameLayer: PropTypes.func.isRequired,\n  onDeleteLayer: PropTypes.func.isRequired\n}\n\nexport default LayerSelector\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}